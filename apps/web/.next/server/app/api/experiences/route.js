"use strict";(()=>{var e={};e.id=476,e.ids=[476],e.modules={38013:e=>{e.exports=require("mongodb")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},65809:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>y,requestAsyncStorage:()=>f,routeModule:()=>x,serverHooks:()=>v,staticGenerationAsyncStorage:()=>w});var n={};r.r(n),r.d(n,{GET:()=>d,POST:()=>l,runtime:()=>p});var i=r(37260),a=r(71827),o=r(2150),s=r(80643),c=r(23347),u=r(105);let p="nodejs";async function d(){try{let e=await (0,c.E$)();return s.NextResponse.json({experiences:e})}catch(e){return console.error("Get experiences error:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}async function l(e){try{let t=e.cookies.get("auth-token")?.value;if(!t||!(0,u.WX)(t))return s.NextResponse.json({error:"Unauthorized"},{status:401});let r=await e.json();for(let e of["name","duration_mins","price","currency","passenger_limit","description"])if(!r[e])return s.NextResponse.json({error:`${e} is required`},{status:400});let n=await (0,c.JJ)(r);return s.NextResponse.json({experience:n},{status:201})}catch(e){return console.error("Create experience error:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}let x=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/experiences/route",pathname:"/api/experiences",filename:"route",bundlePath:"app/api/experiences/route"},resolvedPagePath:"/workspace/apps/web/app/api/experiences/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:w,serverHooks:v}=x,m="/api/experiences/route";function y(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:w})}},105:(e,t,r)=>{r.d(t,{Qj:()=>u,RA:()=>p,WX:()=>d});var n=r(63337),i=r(57772),a=r.n(i),o=r(41207),s=r.n(o);let c=process.env.JWT_SECRET||"dev-secret-key";async function u(e,t){let r=(await (0,n.N)()).collection("admins"),i=await r.findOne({email:e});return i&&await a().compare(t,i.password)?{...i,_id:i._id.toString()}:null}function p(e){let t={expiresIn:process.env.JWT_EXPIRES_IN||"7d"};return s().sign({adminId:e},c,t)}function d(e){try{return{adminId:s().verify(e,c).adminId}}catch{return null}}},23347:(e,t,r)=>{r.d(t,{BJ:()=>o,E$:()=>a,JJ:()=>s,Uk:()=>u,Yb:()=>c});var n=r(63337),i=r(38013);async function a(){let e=(await (0,n.N)()).collection("experiences");return(await e.find({available:!0}).sort({createdAt:-1}).toArray()).map(e=>({...e,_id:e._id.toString()}))}async function o(e){let t=(await (0,n.N)()).collection("experiences"),r=await t.findOne({_id:new i.ObjectId(e)});return r?{...r,_id:r._id.toString()}:null}async function s(e){let t=(await (0,n.N)()).collection("experiences"),r=new Date,i={...e,available:e.available??!0,createdAt:r,updatedAt:r},a=await t.insertOne(i);return{...i,_id:a.insertedId.toString()}}async function c(e,t){let r=(await (0,n.N)()).collection("experiences");return(await r.updateOne({_id:new i.ObjectId(e)},{$set:{...t,updatedAt:new Date}})).modifiedCount>0}async function u(e){let t=(await (0,n.N)()).collection("experiences");return(await t.deleteOne({_id:new i.ObjectId(e)})).deletedCount>0}},63337:(e,t,r)=>{r.d(t,{N:()=>s});var n=r(38013);let i=process.env.MONGODB_URI,a={},o=null;async function s(){return(await function(){if(!i)throw Error("Please define the MONGODB_URI environment variable");return o||(o=new n.MongoClient(i,a).connect()),o}()).db("kayo")}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[483,592,242],()=>r(65809));module.exports=n})();