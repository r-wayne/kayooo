"use strict";(()=>{var e={};e.id=597,e.ids=[597],e.modules={38013:e=>{e.exports=require("mongodb")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},48500:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>y,requestAsyncStorage:()=>w,routeModule:()=>f,serverHooks:()=>m,staticGenerationAsyncStorage:()=>v});var n={};r.r(n),r.d(n,{GET:()=>l,POST:()=>p,runtime:()=>d});var a=r(37260),i=r(71827),o=r(2150),s=r(80643),u=r(97275),c=r(105);let d="nodejs";async function l(e){try{let{searchParams:t}=new URL(e.url),r=t.get("limit"),n=await (0,u.hd)(r?parseInt(r):void 0);return s.NextResponse.json({aircraft:n})}catch(e){return console.error("Get aircraft error:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}async function p(e){try{let t=e.cookies.get("auth-token")?.value;if(!t||!(0,c.WX)(t))return s.NextResponse.json({error:"Unauthorized"},{status:401});let r=await e.json();for(let e of["title","model","manufacturer","year","currency","specs","description"])if(!r[e])return s.NextResponse.json({error:`${e} is required`},{status:400});let n=await (0,u.Z8)(r);return s.NextResponse.json({aircraft:n},{status:201})}catch(e){return console.error("Create aircraft error:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}let f=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/aircraft/route",pathname:"/api/aircraft",filename:"route",bundlePath:"app/api/aircraft/route"},resolvedPagePath:"/workspace/apps/web/app/api/aircraft/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:w,staticGenerationAsyncStorage:v,serverHooks:m}=f,x="/api/aircraft/route";function y(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:v})}},97275:(e,t,r)=>{r.d(t,{NM:()=>u,Q6:()=>o,Z8:()=>s,hd:()=>i,kd:()=>c});var n=r(63337),a=r(38013);async function i(e){let t=(await (0,n.N)()).collection("aircraft"),r={sort:{createdAt:-1}};return e&&(r.limit=e),(await t.find(e?{available:!0}:{},r).toArray()).map(e=>({...e,_id:e._id.toString()}))}async function o(e){let t=(await (0,n.N)()).collection("aircraft"),r=await t.findOne({_id:new a.ObjectId(e)});return r?{...r,_id:r._id.toString()}:null}async function s(e){let t=(await (0,n.N)()).collection("aircraft"),r=new Date,a={...e,available:e.available??!0,createdAt:r,updatedAt:r},i=await t.insertOne(a);return{...a,_id:i.insertedId.toString()}}async function u(e,t){let r=(await (0,n.N)()).collection("aircraft");return(await r.updateOne({_id:new a.ObjectId(e)},{$set:{...t,updatedAt:new Date}})).modifiedCount>0}async function c(e){let t=(await (0,n.N)()).collection("aircraft");return(await t.deleteOne({_id:new a.ObjectId(e)})).deletedCount>0}},105:(e,t,r)=>{r.d(t,{Qj:()=>c,RA:()=>d,WX:()=>l});var n=r(63337),a=r(57772),i=r.n(a),o=r(41207),s=r.n(o);let u=process.env.JWT_SECRET||"dev-secret-key";async function c(e,t){let r=(await (0,n.N)()).collection("admins"),a=await r.findOne({email:e});return a&&await i().compare(t,a.password)?{...a,_id:a._id.toString()}:null}function d(e){let t={expiresIn:process.env.JWT_EXPIRES_IN||"7d"};return s().sign({adminId:e},u,t)}function l(e){try{return{adminId:s().verify(e,u).adminId}}catch{return null}}},63337:(e,t,r)=>{r.d(t,{N:()=>s});var n=r(38013);let a=process.env.MONGODB_URI,i={},o=null;async function s(){return(await function(){if(!a)throw Error("Please define the MONGODB_URI environment variable");return o||(o=new n.MongoClient(a,i).connect()),o}()).db("kayo")}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[483,592,242],()=>r(48500));module.exports=n})();